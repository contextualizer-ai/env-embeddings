
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://contextualizerai.github.io/env-embeddings/research/RESEARCH_VISION/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Research Vision: Environmental Context Quality Control and Prediction - env-embeddings</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#research-vision-environmental-context-quality-control-and-prediction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="env-embeddings" class="md-header__button md-logo" aria-label="env-embeddings" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            env-embeddings
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Research Vision: Environmental Context Quality Control and Prediction
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/contextualizerai/env-embeddings" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="env-embeddings" class="md-nav__button md-logo" aria-label="env-embeddings" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    env-embeddings
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/contextualizerai/env-embeddings" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-big-picture" class="md-nav__link">
    <span class="md-ellipsis">
      The Big Picture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-insight" class="md-nav__link">
    <span class="md-ellipsis">
      Core Insight
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#three-phase-research-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Three-Phase Research Pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Three-Phase Research Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-find-optimal-envo-combination-current-work" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 1: Find Optimal ENVO Combination ‚úÖ (Current Work)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-identify-and-analyze-outliers-next-step" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 2: Identify and Analyze Outliers üéØ (Next Step)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 2: Identify and Analyze Outliers üéØ (Next Step)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2a-high-ge-low-envo-outliers-metadata-quality-issues" class="md-nav__link">
    <span class="md-ellipsis">
      2A. High GE / Low ENVO Outliers (Metadata Quality Issues)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2b-low-ge-high-envo-outliers-interesting-biology" class="md-nav__link">
    <span class="md-ellipsis">
      2B. Low GE / High ENVO Outliers (Interesting Biology)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-metadata-prediction-and-improvement-future-work" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 3: Metadata Prediction and Improvement üöÄ (Future Work)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 3: Metadata Prediction and Improvement üöÄ (Future Work)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3a-predict-missing-triads" class="md-nav__link">
    <span class="md-ellipsis">
      3A. Predict Missing Triads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3b-flag-suspect-triads" class="md-nav__link">
    <span class="md-ellipsis">
      3B. Flag Suspect Triads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3c-active-learning-for-metadata-improvement" class="md-nav__link">
    <span class="md-ellipsis">
      3C. Active Learning for Metadata Improvement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concrete-next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Concrete Next Steps
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Concrete Next Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#immediate-this-week" class="md-nav__link">
    <span class="md-ellipsis">
      Immediate (This Week)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#short-term-next-sprint" class="md-nav__link">
    <span class="md-ellipsis">
      Short-term (Next Sprint)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medium-term-research-paper" class="md-nav__link">
    <span class="md-ellipsis">
      Medium-term (Research Paper)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-analysis-outlier-investigation" class="md-nav__link">
    <span class="md-ellipsis">
      Example Analysis: Outlier Investigation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expected-outcomes" class="md-nav__link">
    <span class="md-ellipsis">
      Expected Outcomes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Expected Outcomes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scientific-contributions" class="md-nav__link">
    <span class="md-ellipsis">
      Scientific Contributions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#practical-impact" class="md-nav__link">
    <span class="md-ellipsis">
      Practical Impact
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Technical Considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Technical Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#challenges" class="md-nav__link">
    <span class="md-ellipsis">
      Challenges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solutions" class="md-nav__link">
    <span class="md-ellipsis">
      Solutions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-your-vision" class="md-nav__link">
    <span class="md-ellipsis">
      Summary: Your Vision
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="research-vision-environmental-context-quality-control-and-prediction">Research Vision: Environmental Context Quality Control and Prediction</h1>
<h2 id="the-big-picture">The Big Picture</h2>
<p>You're building a <strong>quality control and recommendation system</strong> for environmental metadata using the divergence between satellite imagery (objective, physical) and ontological annotations (subjective, curator-provided).</p>
<h2 id="core-insight">Core Insight</h2>
<p><strong>Disagreement between Google Earth embeddings and ENVO embeddings is informative:</strong></p>
<ul>
<li><strong>High GE similarity + High ENVO similarity</strong> ‚Üí Good metadata, samples are genuinely similar</li>
<li><strong>High GE similarity + Low ENVO similarity</strong> ‚Üí <strong>Metadata quality issue</strong> - physically similar locations have inconsistent annotations</li>
<li><strong>Low GE similarity + High ENVO similarity</strong> ‚Üí Different locations can share environmental context (e.g., both "forest" but different continents)</li>
</ul>
<h2 id="three-phase-research-pipeline">Three-Phase Research Pipeline</h2>
<h3 id="phase-1-find-optimal-envo-combination-current-work">Phase 1: Find Optimal ENVO Combination ‚úÖ (Current Work)</h3>
<p><strong>Goal:</strong> Determine which combination of MIxS environmental context variables best predicts satellite-based similarity</p>
<p><strong>Approaches:</strong>
1. Individual scales: <code>broad_scale</code>, <code>medium</code>, <code>local_scale</code>
2. Concatenation: <code>[broad; medium; local]</code> (4608-dim)
3. Weighted average: <code>(broad + medium + local) / 3</code> (1536-dim)
4. Learned weights: <code>w1¬∑broad + w2¬∑medium + w3¬∑local</code> (future)</p>
<p><strong>Success Metric:</strong> Highest Pearson correlation with GE embeddings after removing degenerate pairs</p>
<p><strong>Current Status:</strong> Implemented in notebook, will reveal best combination</p>
<hr />
<h3 id="phase-2-identify-and-analyze-outliers-next-step">Phase 2: Identify and Analyze Outliers üéØ (Next Step)</h3>
<p><strong>Goal:</strong> Find samples with suspicious metadata by detecting divergence between physical and semantic similarity</p>
<h4 id="2a-high-ge-low-envo-outliers-metadata-quality-issues">2A. High GE / Low ENVO Outliers (Metadata Quality Issues)</h4>
<p><strong>Example Scenario:</strong></p>
<pre><code>Sample A: (35.7¬∞N, 139.8¬∞E, 2018) - ENVO: &quot;terrestrial biome | soil | agricultural field&quot;
Sample B: (35.7¬∞N, 139.8¬∞E, 2018) - ENVO: &quot;marine biome | sea water | coastal zone&quot;

GE Similarity: 0.99 (same location, same date ‚Üí nearly identical satellite view)
ENVO Similarity: 0.25 (completely different biomes!)

‚Üí FLAG: One of these annotations is wrong
</code></pre>
<p><strong>Detection Method:</strong></p>
<pre><code class="language-python"># Define outliers as pairs in the upper-right quadrant
outliers_metadata_issue = pairs_filtered[
    (pairs_filtered['ge_similarity'] &gt; 0.8) &amp;  # Physically very similar
    (pairs_filtered['envo_best_similarity'] &lt; 0.3)  # Semantically very different
]
</code></pre>
<p><strong>Analysis Questions:</strong>
1. How many outlier pairs exist?
2. Do certain biosamples appear repeatedly in outlier pairs? (chronic bad metadata)
3. Are there patterns? (e.g., marine/terrestrial confusion, missing terms)</p>
<h4 id="2b-low-ge-high-envo-outliers-interesting-biology">2B. Low GE / High ENVO Outliers (Interesting Biology)</h4>
<p><strong>Example Scenario:</strong></p>
<pre><code>Sample A: (34.0¬∞N, 118.2¬∞W) - California desert
Sample B: (31.2¬∞N, 29.9¬∞E) - Egyptian desert

GE Similarity: 0.15 (different continents, different geology)
ENVO Similarity: 0.95 (both &quot;desert biome | sand | arid soil&quot;)

‚Üí VALID: Similar environment types in different locations
</code></pre>
<p>These are <strong>not errors</strong> - they show that ENVO terms successfully capture environmental similarity across geography.</p>
<hr />
<h3 id="phase-3-metadata-prediction-and-improvement-future-work">Phase 3: Metadata Prediction and Improvement üöÄ (Future Work)</h3>
<p><strong>Goal:</strong> Use satellite imagery to propose or validate ENVO triads</p>
<h4 id="3a-predict-missing-triads">3A. Predict Missing Triads</h4>
<p><strong>Scenario:</strong> Sample has coordinates/date but missing ENVO terms</p>
<p><strong>Method:</strong></p>
<pre><code class="language-python">def predict_envo_triad(sample_coords, sample_date, training_data):
    &quot;&quot;&quot;
    Predict ENVO triad for a sample with missing metadata.

    1. Get Google Earth embedding for target sample
    2. Find k-nearest neighbors by GE embedding similarity
    3. Aggregate their ENVO triads (majority vote or weighted average)
    4. Return predicted broad/medium/local scale terms
    &quot;&quot;&quot;

    # Get GE embedding for target
    target_ge_embedding = get_embedding(lat, lon, year)

    # Find similar samples by satellite imagery
    similarities = []
    for train_sample in training_data:
        sim = cosine_similarity(target_ge_embedding, train_sample.ge_embedding)
        similarities.append((sim, train_sample))

    # Get top-k most similar samples
    top_k = sorted(similarities, reverse=True)[:10]

    # Aggregate their ENVO terms (majority vote)
    broad_candidates = [s.envo_broad for _, s in top_k]
    medium_candidates = [s.envo_medium for _, s in top_k]
    local_candidates = [s.envo_local for _, s in top_k]

    return {
        'broad_scale': most_common(broad_candidates),
        'medium': most_common(medium_candidates),
        'local_scale': most_common(local_candidates),
        'confidence': top_k[0][0]  # similarity to nearest neighbor
    }
</code></pre>
<p><strong>Validation:</strong>
- Hold out 20% of samples with known triads
- Predict their triads using only GE embeddings
- Measure accuracy: How often do we get the exact triad correct?</p>
<h4 id="3b-flag-suspect-triads">3B. Flag Suspect Triads</h4>
<p><strong>Scenario:</strong> Sample has ENVO triad but it disagrees with satellite imagery</p>
<p><strong>Method:</strong></p>
<pre><code class="language-python">def flag_suspect_triads(sample, training_data, threshold=0.7):
    &quot;&quot;&quot;
    Flag samples whose ENVO triad is inconsistent with their satellite imagery.

    Returns:
        List of alternative triad suggestions with confidence scores
    &quot;&quot;&quot;

    # Find samples with similar GE embeddings (physically similar)
    similar_by_satellite = find_similar_samples(
        sample.ge_embedding,
        training_data,
        similarity_threshold=0.8
    )

    # Check if their ENVO triads agree
    triad_agreement = []
    for sim_sample in similar_by_satellite:
        envo_sim = cosine_similarity(
            sample.envo_embedding,
            sim_sample.envo_embedding
        )
        triad_agreement.append(envo_sim)

    avg_agreement = mean(triad_agreement)

    if avg_agreement &lt; threshold:
        # This sample's triad disagrees with physically similar samples
        # Propose alternative triads from the similar samples
        alternative_triads = aggregate_triads(similar_by_satellite)

        return {
            'flagged': True,
            'reason': f'Low ENVO agreement ({avg_agreement:.2f}) with physically similar samples',
            'current_triad': sample.envo_triad,
            'suggested_alternatives': alternative_triads,
            'similar_samples': [s.accession for s in similar_by_satellite[:5]]
        }

    return {'flagged': False}
</code></pre>
<p><strong>Use Cases:</strong>
1. <strong>Quality Control:</strong> Curators review flagged samples before publication
2. <strong>Batch Correction:</strong> Identify systematic errors (e.g., swapped broad/local scales)
3. <strong>Metadata Enrichment:</strong> Suggest triads for older samples lacking structured metadata</p>
<h4 id="3c-active-learning-for-metadata-improvement">3C. Active Learning for Metadata Improvement</h4>
<p><strong>Goal:</strong> Prioritize which samples to manually review</p>
<p><strong>Method:</strong></p>
<pre><code class="language-python">def prioritize_for_manual_review(samples):
    &quot;&quot;&quot;
    Rank samples by potential metadata impact.

    Priority factors:
    1. High GE/ENVO disagreement (likely error)
    2. Many other samples depend on this one (high influence)
    3. Rare environmental context (filling gaps in training data)
    &quot;&quot;&quot;

    scores = []
    for sample in samples:
        # Factor 1: Disagreement score
        disagreement = calculate_ge_envo_disagreement(sample)

        # Factor 2: Influence score (how many samples are similar to this one?)
        influence = count_similar_samples(sample, threshold=0.8)

        # Factor 3: Rarity score (is this an underrepresented environment?)
        rarity = calculate_envo_rarity(sample.envo_triad)

        # Combined priority score
        priority = 0.5 * disagreement + 0.3 * influence + 0.2 * rarity
        scores.append((priority, sample))

    return sorted(scores, reverse=True)
</code></pre>
<hr />
<h2 id="concrete-next-steps">Concrete Next Steps</h2>
<h3 id="immediate-this-week">Immediate (This Week)</h3>
<ol>
<li><strong>Run updated notebook</strong> to determine best ENVO combination</li>
<li><strong>Add outlier detection cell</strong> to identify high-GE/low-ENVO pairs</li>
<li><strong>Analyze outlier patterns:</strong></li>
<li>Which samples appear most frequently?</li>
<li>Are there systematic errors (e.g., marine/terrestrial swaps)?</li>
<li>Manual inspection of top 10 outlier pairs</li>
</ol>
<h3 id="short-term-next-sprint">Short-term (Next Sprint)</h3>
<ol>
<li><strong>Build triad prediction prototype:</strong></li>
<li>K-nearest neighbors by GE embedding</li>
<li>Majority vote for ENVO terms</li>
<li>
<p>Cross-validation to measure accuracy</p>
</li>
<li>
<p><strong>Create suspect triad report:</strong></p>
</li>
<li>List samples with low ENVO agreement among GE-similar samples</li>
<li>Generate suggested alternative triads</li>
<li>Export for manual review</li>
</ol>
<h3 id="medium-term-research-paper">Medium-term (Research Paper)</h3>
<ol>
<li><strong>Systematic evaluation:</strong></li>
<li>Holdout test set (20% of samples)</li>
<li>Measure triad prediction accuracy</li>
<li>
<p>Compare to baseline (random, most-frequent, etc.)</p>
</li>
<li>
<p><strong>Case studies:</strong></p>
</li>
<li>Manual review of flagged samples</li>
<li>Work with domain experts to validate predictions</li>
<li>
<p>Quantify metadata improvement</p>
</li>
<li>
<p><strong>Scale up:</strong></p>
</li>
<li>Process full BioSample database (not just 246 samples)</li>
<li>Build web interface for curators</li>
<li>Integrate with submission pipelines</li>
</ol>
<hr />
<h2 id="example-analysis-outlier-investigation">Example Analysis: Outlier Investigation</h2>
<p><strong>Notebook cell to add:</strong></p>
<pre><code class="language-python">print(&quot;=== OUTLIER ANALYSIS: METADATA QUALITY ISSUES ===&quot;)

# Define outliers: High GE similarity but Low ENVO similarity
outliers = pairs_filtered[
    (pairs_filtered['ge_similarity'] &gt; 0.8) &amp;
    (pairs_filtered['envo_best_similarity'] &lt; 0.3)  # Use best ENVO combination
]

print(f&quot;\nFound {len(outliers)} outlier pairs (high GE, low ENVO)&quot;)
print(f&quot;  {len(outliers)/len(pairs_filtered)*100:.1f}% of all pairs\n&quot;)

# Identify samples that appear frequently in outlier pairs
from collections import Counter

outlier_samples = []
for _, pair in outliers.iterrows():
    outlier_samples.append(pair['accession_1'])
    outlier_samples.append(pair['accession_2'])

sample_counts = Counter(outlier_samples)
chronic_outliers = sample_counts.most_common(10)

print(&quot;Samples appearing most frequently in outlier pairs:&quot;)
print(&quot;(These may have incorrect metadata)\n&quot;)
for accession, count in chronic_outliers:
    sample = df_clean[df_clean['accession'] == accession].iloc[0]
    print(f&quot;{accession}: {count} outlier pairs&quot;)
    print(f&quot;  Location: ({sample['latitude']}, {sample['longitude']})&quot;)
    print(f&quot;  ENVO: {sample['env_broad_scale']} | {sample['env_medium']} | {sample['env_local_scale']}&quot;)
    print()

# Show example outlier pairs
print(&quot;\n=== EXAMPLE OUTLIER PAIRS (for manual inspection) ===&quot;)
for idx, (_, pair) in enumerate(outliers.head(5).iterrows()):
    print(f&quot;\nOutlier {idx+1}:&quot;)
    print(f&quot;  GE Similarity: {pair['ge_similarity']:.3f}&quot;)
    print(f&quot;  ENVO Similarity: {pair['envo_best_similarity']:.3f}&quot;)
    print(f&quot;  Œî (disagreement): {pair['ge_similarity'] - pair['envo_best_similarity']:.3f}&quot;)

    sample1 = df_clean[df_clean['accession'] == pair['accession_1']].iloc[0]
    sample2 = df_clean[df_clean['accession'] == pair['accession_2']].iloc[0]

    print(f&quot;\n  Sample 1: {sample1['accession']}&quot;)
    print(f&quot;    Location: ({sample1['latitude']:.4f}, {sample1['longitude']:.4f})&quot;)
    print(f&quot;    ENVO: {sample1['env_broad_scale']} | {sample1['env_medium']} | {sample1['env_local_scale']}&quot;)

    print(f&quot;\n  Sample 2: {sample2['accession']}&quot;)
    print(f&quot;    Location: ({sample2['latitude']:.4f}, {sample2['longitude']:.4f})&quot;)
    print(f&quot;    ENVO: {sample2['env_broad_scale']} | {sample2['env_medium']} | {sample2['env_local_scale']}&quot;)

    print(f&quot;\n  ‚Üí DIAGNOSIS: Samples are physically very similar (GE={pair['ge_similarity']:.2f})&quot;)
    print(f&quot;               but have very different ENVO terms (ENVO={pair['envo_best_similarity']:.2f})&quot;)
    print(f&quot;               One of these metadata annotations is likely incorrect.&quot;)
</code></pre>
<hr />
<h2 id="expected-outcomes">Expected Outcomes</h2>
<h3 id="scientific-contributions">Scientific Contributions</h3>
<ol>
<li>
<p><strong>Quantify metadata quality:</strong> What % of BioSample metadata is inconsistent with satellite imagery?</p>
</li>
<li>
<p><strong>Automate quality control:</strong> Flag suspect samples before publication</p>
</li>
<li>
<p><strong>Metadata prediction:</strong> Provide triads for samples lacking structured annotations</p>
</li>
<li>
<p><strong>Training data curation:</strong> Identify high-quality samples for ML training</p>
</li>
</ol>
<h3 id="practical-impact">Practical Impact</h3>
<ol>
<li>
<p><strong>Reduce curator burden:</strong> Automated suggestions reduce manual annotation time</p>
</li>
<li>
<p><strong>Improve data quality:</strong> Catch errors early in submission pipeline</p>
</li>
<li>
<p><strong>Enable better science:</strong> Higher quality metadata ‚Üí better meta-analyses</p>
</li>
<li>
<p><strong>Fill metadata gaps:</strong> Millions of samples lack ENVO triads - we can predict them</p>
</li>
</ol>
<hr />
<h2 id="technical-considerations">Technical Considerations</h2>
<h3 id="challenges">Challenges</h3>
<ol>
<li><strong>ENVO term granularity:</strong></li>
<li>"forest" vs "temperate forest" vs "temperate coniferous forest"</li>
<li>
<p>Should we compare at different ontology depths?</p>
</li>
<li>
<p><strong>Temporal changes:</strong></p>
</li>
<li>Satellite imagery from 2018, sample collected in 2010</li>
<li>
<p>Land use changes (urban development, deforestation)</p>
</li>
<li>
<p><strong>Scale mismatch:</strong></p>
</li>
<li>GE embeddings: 10m resolution</li>
<li>ENVO broad_scale: biome-level (100s of km)</li>
<li>
<p>Which scale should agree?</p>
</li>
<li>
<p><strong>Training data bias:</strong></p>
</li>
<li>Current 246 samples may not represent all environments</li>
<li>Need larger, more diverse training set</li>
</ol>
<h3 id="solutions">Solutions</h3>
<ol>
<li><strong>Hierarchical ENVO comparison:</strong></li>
<li>Compare at multiple ontology depths</li>
<li>
<p>Weight by specificity (more specific = higher weight)</p>
</li>
<li>
<p><strong>Temporal filtering:</strong></p>
</li>
<li>Only use samples where collection_date ‚âà satellite_date</li>
<li>
<p>Or model temporal changes explicitly</p>
</li>
<li>
<p><strong>Multi-scale analysis:</strong></p>
</li>
<li>Compare local_scale to local GE features</li>
<li>
<p>Compare broad_scale to regional GE patterns</p>
</li>
<li>
<p><strong>Active learning:</strong></p>
</li>
<li>Iteratively expand training set</li>
<li>Prioritize diverse environments</li>
</ol>
<hr />
<h2 id="summary-your-vision">Summary: Your Vision</h2>
<p>You're building a <strong>virtuous cycle</strong> for environmental metadata:</p>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Satellite Imagery (Objective, Physical)            ‚îÇ
‚îÇ  ‚Üì                                                   ‚îÇ
‚îÇ  Google Earth Embeddings                            ‚îÇ
‚îÇ  ‚Üì                                                   ‚îÇ
‚îÇ  Compare with ENVO Embeddings (Semantic, Curated)   ‚îÇ
‚îÇ  ‚Üì                                                   ‚îÇ
‚îÇ  Identify Outliers (High GE / Low ENVO)             ‚îÇ
‚îÇ  ‚Üì                                                   ‚îÇ
‚îÇ  Flag Suspect Metadata                              ‚îÇ
‚îÇ  ‚Üì                                                   ‚îÇ
‚îÇ  Predict/Suggest Corrections                        ‚îÇ
‚îÇ  ‚Üì                                                   ‚îÇ
‚îÇ  Human Review &amp; Correction                          ‚îÇ
‚îÇ  ‚Üì                                                   ‚îÇ
‚îÇ  Improved Training Data                             ‚îÇ
‚îÇ  ‚Üì                                                   ‚îÇ
‚îÇ  Better Predictions (loop back to top)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre>
<p>This is <strong>quality control through cross-validation</strong> between independent data sources (satellite vs curator), using embedding similarity as the bridge.</p>
<p>Brilliant research direction! üöÄ</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>