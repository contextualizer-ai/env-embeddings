
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://contextualizerai.github.io/env-embeddings/analysis/SCIENTIFIC_ANALYSIS/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Scientific Analysis: Methodological Concerns in similarity_analysis.ipynb - env-embeddings</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#scientific-analysis-methodological-concerns-in-similarity_analysisipynb" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="env-embeddings" class="md-header__button md-logo" aria-label="env-embeddings" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            env-embeddings
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Scientific Analysis: Methodological Concerns in similarity_analysis.ipynb
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/contextualizerai/env-embeddings" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="env-embeddings" class="md-nav__button md-logo" aria-label="env-embeddings" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    env-embeddings
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/contextualizerai/env-embeddings" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary-of-critical-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Summary of Critical Issues
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-self-pairs-problem-inflated-correlations-from-identical-samples" class="md-nav__link">
    <span class="md-ellipsis">
      1. Self-Pairs Problem: Inflated Correlations from Identical Samples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Self-Pairs Problem: Inflated Correlations from Identical Samples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-issue" class="md-nav__link">
    <span class="md-ellipsis">
      The Issue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-this-inflates-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      Why This Inflates Correlation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evidence-in-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      Evidence in the Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-solution" class="md-nav__link">
    <span class="md-ellipsis">
      The Solution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-sample-size-is-1000-pairs-enough" class="md-nav__link">
    <span class="md-ellipsis">
      2. Sample Size: Is 1000 Pairs Enough?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Sample Size: Is 1000 Pairs Enough?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-situation" class="md-nav__link">
    <span class="md-ellipsis">
      Current Situation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guidelines-for-pair-sampling" class="md-nav__link">
    <span class="md-ellipsis">
      Guidelines for Pair Sampling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-real-question-representative-sampling" class="md-nav__link">
    <span class="md-ellipsis">
      The Real Question: Representative Sampling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Recommendations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-sampling-methodology-random-pairs-with-replacement" class="md-nav__link">
    <span class="md-ellipsis">
      3. Sampling Methodology: Random Pairs with Replacement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Sampling Methodology: Random Pairs with Replacement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-implementation-cell-8" class="md-nav__link">
    <span class="md-ellipsis">
      Current Implementation (Cell 8)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problems" class="md-nav__link">
    <span class="md-ellipsis">
      Problems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#better-approach" class="md-nav__link">
    <span class="md-ellipsis">
      Better Approach
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-dependency-between-pairs" class="md-nav__link">
    <span class="md-ellipsis">
      4. Dependency Between Pairs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Dependency Between Pairs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      The Problem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#impact-on-p-values" class="md-nav__link">
    <span class="md-ellipsis">
      Impact on p-values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correction-approaches" class="md-nav__link">
    <span class="md-ellipsis">
      Correction Approaches
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-proposed-sensitivity-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      5. Proposed Sensitivity Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Proposed Sensitivity Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-1-exclude-high-similarity-pairs" class="md-nav__link">
    <span class="md-ellipsis">
      Test 1: Exclude High-Similarity Pairs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-2-exclude-perfect-matches" class="md-nav__link">
    <span class="md-ellipsis">
      Test 2: Exclude Perfect Matches
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-3-increase-sample-size" class="md-nav__link">
    <span class="md-ellipsis">
      Test 3: Increase Sample Size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-4-stratified-sampling" class="md-nav__link">
    <span class="md-ellipsis">
      Test 4: Stratified Sampling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-additional-statistical-concerns" class="md-nav__link">
    <span class="md-ellipsis">
      6. Additional Statistical Concerns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Additional Statistical Concerns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multiple-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distribution-of-similarities" class="md-nav__link">
    <span class="md-ellipsis">
      Distribution of Similarities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      7. Recommendations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#immediate-actions-easy-wins" class="md-nav__link">
    <span class="md-ellipsis">
      Immediate Actions (Easy Wins)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medium-term-improvements" class="md-nav__link">
    <span class="md-ellipsis">
      Medium-Term Improvements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#long-term-requires-more-data" class="md-nav__link">
    <span class="md-ellipsis">
      Long-Term (Requires More Data)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-concrete-next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      8. Concrete Next Steps
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Concrete Next Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-new-notebook-cell-sensitivity-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Create New Notebook Cell: Sensitivity Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modify-cell-8-sample-all-pairs" class="md-nav__link">
    <span class="md-ellipsis">
      Modify Cell 8: Sample ALL Pairs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-expected-outcomes" class="md-nav__link">
    <span class="md-ellipsis">
      9. Expected Outcomes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Expected Outcomes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-correlation-remains-strong-after-filtering-r-07" class="md-nav__link">
    <span class="md-ellipsis">
      If correlation remains strong after filtering (r &gt; 0.7):
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if-correlation-drops-substantially-r-05" class="md-nav__link">
    <span class="md-ellipsis">
      If correlation drops substantially (r &lt; 0.5):
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#most-likely-scenario" class="md-nav__link">
    <span class="md-ellipsis">
      Most Likely Scenario:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-summary" class="md-nav__link">
    <span class="md-ellipsis">
      10. Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="scientific-analysis-methodological-concerns-in-similarity_analysisipynb">Scientific Analysis: Methodological Concerns in similarity_analysis.ipynb</h1>
<h2 id="summary-of-critical-issues">Summary of Critical Issues</h2>
<p>The current notebook shows high correlation coefficients (r=0.811 for broad_scale), but several methodological concerns suggest these results may be inflated or unreliable:</p>
<ol>
<li><strong>Self-pairs inflation</strong> (most critical)</li>
<li><strong>Sample size adequacy</strong></li>
<li><strong>Sampling methodology</strong></li>
<li><strong>Statistical independence</strong></li>
</ol>
<hr />
<h2 id="1-self-pairs-problem-inflated-correlations-from-identical-samples">1. Self-Pairs Problem: Inflated Correlations from Identical Samples</h2>
<h3 id="the-issue">The Issue</h3>
<p>Looking at the output from cell-15 and cell-17, we see <strong>many pairs with similarity = 1.0 for BOTH Google Earth AND all ENVO types</strong>:</p>
<pre><code>High similarity in both (GE &gt; 0.9, ENVO broad_scale &gt; 0.9): 212 pairs
</code></pre>
<p><strong>Out of 1000 pairs, 212 have near-perfect agreement (&gt;0.9 on both metrics).</strong></p>
<p>From cell-17 output, we can see why:</p>
<pre><code>Pair: SAMD00115491 vs SAMD00115487
GE Similarity: 1.000
ENVO broad_scale: 1.000
Sample 1 - Lat/Lon: (35.7128, 139.7619), Date: 2018-02-11
Sample 2 - Lat/Lon: (35.7128, 139.7619), Date: 2018-02-11
Sample 1 ENVO: ENVO:00002030 | ENVO:00002006 | ENVO:00000241
Sample 2 ENVO: ENVO:00002030 | ENVO:00002006 | ENVO:00000241
</code></pre>
<p><strong>These are essentially the same sample!</strong> Same location, same date, same ENVO terms → 1.0 similarity on both axes.</p>
<h3 id="why-this-inflates-correlation">Why This Inflates Correlation</h3>
<p>When you have many (1,1) points in a correlation analysis:
- Pearson correlation is <strong>extremely sensitive</strong> to these perfect-agreement points
- They create an artificial "anchor" at (1,1) that pulls the correlation line upward
- This can make a weak/moderate correlation appear strong</p>
<h3 id="evidence-in-the-data">Evidence in the Data</h3>
<p>From the current run with 246 samples:
- <strong>212/1000 pairs (21%)</strong> have GE &gt; 0.9 AND ENVO broad &gt; 0.9
- Many of these are likely <strong>self-pairs</strong> (same location, same ENVO terms)
- The dataset has many samples from <strong>same locations</strong> (e.g., (35.7128, 139.7619) appears multiple times)</p>
<h3 id="the-solution">The Solution</h3>
<p><strong>Exclude self-pairs and near-duplicates:</strong></p>
<ol>
<li><strong>Remove identical samples</strong>: Don't compare samples with identical coordinates + ENVO terms</li>
<li><strong>Apply similarity threshold</strong>: Exclude pairs where EITHER metric &gt; 0.95 (likely duplicates)</li>
<li><strong>Re-calculate correlations</strong> on the cleaned dataset</li>
</ol>
<hr />
<h2 id="2-sample-size-is-1000-pairs-enough">2. Sample Size: Is 1000 Pairs Enough?</h2>
<h3 id="current-situation">Current Situation</h3>
<ul>
<li><strong>246 samples</strong> total</li>
<li><strong>1000 random pairs</strong> generated</li>
<li>Maximum possible unique pairs: C(246, 2) = <strong>30,135 pairs</strong></li>
<li>Current sampling: <strong>1000/30,135 = 3.3%</strong> of all possible pairs</li>
</ul>
<h3 id="guidelines-for-pair-sampling">Guidelines for Pair Sampling</h3>
<p>From statistical literature on correlation analysis:</p>
<p><strong>Power Analysis for Correlation:</strong>
- To detect r=0.8 with 80% power and α=0.05: <strong>n ≥ 12 pairs</strong>
- To detect r=0.5 with 80% power: <strong>n ≥ 29 pairs</strong>
- To detect r=0.3 with 80% power: <strong>n ≥ 84 pairs</strong></p>
<p>So <strong>1000 pairs is MORE than sufficient</strong> for statistical power.</p>
<p><strong>But...</strong></p>
<h3 id="the-real-question-representative-sampling">The Real Question: Representative Sampling</h3>
<p>With 246 samples and 1000 pairs:
- Average sample appears in: 1000 × 2 / 246 ≈ <strong>8 pairs</strong>
- Some samples may appear 0 times, others 20+ times (random variation)
- This creates <strong>dependency</strong> between pairs (not truly independent observations)</p>
<h3 id="recommendations">Recommendations</h3>
<p><strong>Option 1: Sample ALL pairs</strong> (computational cost)
- 30,135 pairs is not computationally prohibitive
- Ensures complete coverage
- Removes sampling bias</p>
<p><strong>Option 2: Stratified random sampling</strong>
- Ensure each sample appears in at least N pairs (e.g., 5-10)
- Better coverage than pure random sampling
- Still computationally efficient</p>
<p><strong>Option 3: Increase to 5000-10000 pairs</strong>
- Covers ~17-33% of all possible pairs
- More stable estimates
- Since computation is fast (you mentioned "doesn't take too much time"), this is easy to do</p>
<hr />
<h2 id="3-sampling-methodology-random-pairs-with-replacement">3. Sampling Methodology: Random Pairs with Replacement</h2>
<h3 id="current-implementation-cell-8">Current Implementation (Cell 8)</h3>
<pre><code class="language-python">n_pairs = 1000
for i in range(n_pairs):
    idx1, idx2 = random.sample(range(n_samples), 2)
    pairs.append((idx1, idx2))
</code></pre>
<p><strong>This is sampling WITHOUT replacement within each pair</strong> (idx1 ≠ idx2), but <strong>WITH replacement across pairs</strong> (same pair can be selected multiple times).</p>
<h3 id="problems">Problems</h3>
<ol>
<li><strong>Duplicate pairs</strong>: (A, B) could be selected multiple times</li>
<li><strong>Asymmetric pairs</strong>: Both (A, B) and (B, A) could be selected (though similarity is symmetric, this wastes samples)</li>
<li><strong>Non-uniform coverage</strong>: Some pairs over-sampled, others never sampled</li>
</ol>
<h3 id="better-approach">Better Approach</h3>
<p><strong>For small datasets (like 246 samples):</strong></p>
<pre><code class="language-python"># Generate ALL unique pairs
from itertools import combinations
all_pairs = list(combinations(range(n_samples), 2))

# Optional: Sample from all_pairs if needed
if len(all_pairs) &gt; max_pairs:
    pairs = random.sample(all_pairs, max_pairs)
else:
    pairs = all_pairs
</code></pre>
<p><strong>Advantages:</strong>
- No duplicate pairs
- Guaranteed unique coverage
- More statistically rigorous</p>
<hr />
<h2 id="4-dependency-between-pairs">4. Dependency Between Pairs</h2>
<h3 id="the-problem">The Problem</h3>
<p>Pairs are <strong>not independent observations</strong> when samples are reused:</p>
<p>Example:
- Pair 1: (A, B) → similarity = 0.8
- Pair 2: (A, C) → similarity = 0.6
- Pair 3: (B, C) → similarity = 0.7</p>
<p>All three pairs share samples, so they're not independent. This violates the <strong>independence assumption</strong> of correlation tests (Pearson, Spearman).</p>
<h3 id="impact-on-p-values">Impact on p-values</h3>
<p>The reported p-values (e.g., p=6.81e-235) assume <strong>independent observations</strong>. With dependent pairs:
- p-values are <strong>too small</strong> (overconfident)
- Standard errors are <strong>underestimated</strong>
- Confidence intervals are <strong>too narrow</strong></p>
<h3 id="correction-approaches">Correction Approaches</h3>
<p><strong>Option 1: Permutation testing</strong>
- Shuffle one embedding type, recalculate correlation, repeat 10,000 times
- Empirical p-value from permutation distribution
- Doesn't assume independence</p>
<p><strong>Option 2: Bootstrap confidence intervals</strong>
- Resample samples (not pairs), generate new pairs, calculate correlation
- Repeat 10,000 times
- 95% CI from bootstrap distribution</p>
<p><strong>Option 3: Report effect size only</strong>
- Don't rely on p-values
- Focus on correlation magnitude and practical significance</p>
<hr />
<h2 id="5-proposed-sensitivity-analysis">5. Proposed Sensitivity Analysis</h2>
<h3 id="test-1-exclude-high-similarity-pairs">Test 1: Exclude High-Similarity Pairs</h3>
<p>Remove pairs where <strong>either</strong> GE or ENVO similarity &gt; 0.95:</p>
<pre><code class="language-python"># Exclude likely duplicates
pairs_filtered = pairs_df[
    (pairs_df['ge_similarity'] &lt; 0.95) &amp;
    (pairs_df['envo_broad_similarity'] &lt; 0.95)
]

# Recalculate correlation
pearson_filtered, p_filtered = pearsonr(
    pairs_filtered['ge_similarity'],
    pairs_filtered['envo_broad_similarity']
)
</code></pre>
<p><strong>Expected outcome:</strong>
- If correlation drops significantly (e.g., 0.811 → 0.4), the result is driven by duplicates
- If correlation stays strong (0.811 → 0.7+), the relationship is robust</p>
<h3 id="test-2-exclude-perfect-matches">Test 2: Exclude Perfect Matches</h3>
<p>Remove pairs where <strong>both</strong> GE AND ENVO similarity = 1.0:</p>
<pre><code class="language-python">pairs_no_perfect = pairs_df[
    ~((pairs_df['ge_similarity'] == 1.0) &amp;
      (pairs_df['envo_broad_similarity'] == 1.0))
]
</code></pre>
<h3 id="test-3-increase-sample-size">Test 3: Increase Sample Size</h3>
<p>Run with <strong>10,000 pairs</strong> or <strong>ALL possible pairs</strong>:</p>
<pre><code class="language-python"># Generate all unique pairs
from itertools import combinations
all_pairs = list(combinations(range(len(df_clean)), 2))
print(f&quot;Total unique pairs: {len(all_pairs)}&quot;)
</code></pre>
<p>Check if correlation coefficient stabilizes or changes.</p>
<h3 id="test-4-stratified-sampling">Test 4: Stratified Sampling</h3>
<p>Ensure diverse pairs by sampling across environmental categories:</p>
<pre><code class="language-python"># Group by ENVO broad_scale term
groups = df_clean.groupby('env_broad_scale')

# Sample pairs within and across groups
within_group_pairs = []  # Same ENVO term
across_group_pairs = []  # Different ENVO terms
</code></pre>
<hr />
<h2 id="6-additional-statistical-concerns">6. Additional Statistical Concerns</h2>
<h3 id="multiple-testing">Multiple Testing</h3>
<p>The notebook tests <strong>3 ENVO types</strong> (broad, medium, local) against GE.
- With no correction, we expect 1/20 false positives at α=0.05
- Should apply <strong>Bonferroni correction</strong>: α_corrected = 0.05/3 = 0.0167
- Or report False Discovery Rate (FDR) adjusted p-values</p>
<h3 id="distribution-of-similarities">Distribution of Similarities</h3>
<p>From cell-11 output:</p>
<pre><code>Google Earth Embeddings:
  Mean: 0.381
  Range: [-0.088, 1.000]

ENVO broad_scale:
  Mean: 0.636
  Range: [0.210, 1.000]
</code></pre>
<p><strong>GE similarities can be negative</strong> (cosine similarity range: [-1, 1])
<strong>ENVO similarities are all positive</strong> (OpenAI embeddings are typically [0, 1])</p>
<p>This <strong>asymmetry</strong> might affect correlation:
- Pearson correlation assumes <strong>linear relationship</strong>
- If relationship is non-linear, Pearson may be misleading
- Spearman (rank-based) is more robust</p>
<p><strong>Observation:</strong> Spearman is consistently lower (0.677 vs 0.811 for broad_scale)
- Suggests relationship may not be perfectly linear
- Or there are outliers influencing Pearson</p>
<hr />
<h2 id="7-recommendations">7. Recommendations</h2>
<h3 id="immediate-actions-easy-wins">Immediate Actions (Easy Wins)</h3>
<ol>
<li><strong>Add sensitivity analysis cell:</strong></li>
<li>Exclude pairs with similarity &gt; 0.95 on either metric</li>
<li>Exclude perfect (1.0, 1.0) pairs</li>
<li>
<p>Report correlations before/after filtering</p>
</li>
<li>
<p><strong>Increase to ALL pairs or 10,000 pairs:</strong></p>
</li>
<li>You said computation is fast</li>
<li>This is scientifically more rigorous</li>
<li>
<p>30,135 pairs is not computationally expensive</p>
</li>
<li>
<p><strong>Add robustness checks:</strong></p>
</li>
<li>Bootstrap confidence intervals (1000 iterations)</li>
<li>Permutation test for p-values</li>
<li>Report effect sizes with CIs, not just p-values</li>
</ol>
<h3 id="medium-term-improvements">Medium-Term Improvements</h3>
<ol>
<li><strong>Stratified analysis:</strong></li>
<li>Separate correlations by ENVO term frequency</li>
<li>
<p>Do rare ENVO terms show different patterns?</p>
</li>
<li>
<p><strong>Visualize outliers:</strong></p>
</li>
<li>Identify pairs driving the correlation</li>
<li>
<p>Are high-correlation points real or duplicates?</p>
</li>
<li>
<p><strong>Multiple testing correction:</strong></p>
</li>
<li>Bonferroni or FDR correction for 3 ENVO types</li>
</ol>
<h3 id="long-term-requires-more-data">Long-Term (Requires More Data)</h3>
<ol>
<li><strong>Process more samples:</strong></li>
<li>Current: 246 samples</li>
<li>You mentioned "we can easily provide more now"</li>
<li>
<p>Target: 1000+ samples for robust analysis</p>
</li>
<li>
<p><strong>Cross-validation:</strong></p>
</li>
<li>Split data into train/test sets</li>
<li>Check if correlation generalizes</li>
</ol>
<hr />
<h2 id="8-concrete-next-steps">8. Concrete Next Steps</h2>
<h3 id="create-new-notebook-cell-sensitivity-analysis">Create New Notebook Cell: Sensitivity Analysis</h3>
<pre><code class="language-python">print(&quot;=== SENSITIVITY ANALYSIS ===&quot;)

# Original correlation
print(f&quot;\nOriginal (all {len(pairs_df)} pairs):&quot;)
print(f&quot;  Pearson r = {pearson_broad:.3f}&quot;)

# Test 1: Remove high-similarity pairs
pairs_filtered = pairs_df[
    (pairs_df['ge_similarity'] &lt; 0.95) &amp;
    (pairs_df['envo_broad_similarity'] &lt; 0.95)
]
r_filtered, p_filtered = pearsonr(
    pairs_filtered['ge_similarity'],
    pairs_filtered['envo_broad_similarity']
)
print(f&quot;\nAfter removing similarity &gt; 0.95 ({len(pairs_filtered)} pairs):&quot;)
print(f&quot;  Pearson r = {r_filtered:.3f}&quot;)
print(f&quot;  Change: {r_filtered - pearson_broad:.3f}&quot;)

# Test 2: Remove perfect matches
pairs_no_perfect = pairs_df[
    ~((pairs_df['ge_similarity'] == 1.0) &amp;
      (pairs_df['envo_broad_similarity'] == 1.0))
]
r_no_perfect, p_no_perfect = pearsonr(
    pairs_no_perfect['ge_similarity'],
    pairs_no_perfect['envo_broad_similarity']
)
print(f&quot;\nAfter removing (1.0, 1.0) pairs ({len(pairs_no_perfect)} pairs):&quot;)
print(f&quot;  Pearson r = {r_no_perfect:.3f}&quot;)
print(f&quot;  Change: {r_no_perfect - pearson_broad:.3f}&quot;)

# Test 3: Bootstrap confidence intervals
from scipy.stats import bootstrap
data = (pairs_df['ge_similarity'].values, pairs_df['envo_broad_similarity'].values)
def correlation_statistic(x, y):
    return pearsonr(x, y)[0]

# This requires scipy &gt;= 1.7
# res = bootstrap(data, correlation_statistic, n_resamples=1000, method='percentile')
# print(f&quot;\n95% Bootstrap CI: [{res.confidence_interval.low:.3f}, {res.confidence_interval.high:.3f}]&quot;)
</code></pre>
<h3 id="modify-cell-8-sample-all-pairs">Modify Cell 8: Sample ALL Pairs</h3>
<pre><code class="language-python">from itertools import combinations

# Generate ALL unique pairs instead of random sample
print(f&quot;Generating all unique pairs from {n_samples} samples...&quot;)
all_possible_pairs = list(combinations(range(n_samples), 2))
print(f&quot;Total unique pairs: {len(all_possible_pairs)}&quot;)

# Use all pairs (computation is fast)
pairs = all_possible_pairs

# Or limit if needed (but 30K pairs should be fast)
# max_pairs = 10000
# if len(all_possible_pairs) &gt; max_pairs:
#     pairs = random.sample(all_possible_pairs, max_pairs)
# else:
#     pairs = all_possible_pairs
</code></pre>
<hr />
<h2 id="9-expected-outcomes">9. Expected Outcomes</h2>
<h3 id="if-correlation-remains-strong-after-filtering-r-07">If correlation remains strong after filtering (r &gt; 0.7):</h3>
<p>✅ The relationship is <strong>real and robust</strong>
✅ Geographic and ontological similarities truly correlate
✅ Results are publishable with proper caveats</p>
<h3 id="if-correlation-drops-substantially-r-05">If correlation drops substantially (r &lt; 0.5):</h3>
<p>❌ Original result was <strong>driven by duplicates/self-pairs</strong>
❌ Need to investigate why so many near-identical samples
❌ May need to deduplicate dataset before analysis</p>
<h3 id="most-likely-scenario">Most Likely Scenario:</h3>
<ul>
<li>Correlation drops moderately (0.811 → 0.6-0.7)</li>
<li>Still significant and meaningful</li>
<li>More honest assessment of relationship strength</li>
</ul>
<hr />
<h2 id="10-summary">10. Summary</h2>
<p><strong>Critical Flaw:</strong> 21% of pairs are near-perfect matches (&gt;0.9, &gt;0.9), likely inflating correlation</p>
<p><strong>Quick Fix:</strong>
1. Filter out high-similarity pairs (&gt;0.95)
2. Use ALL 30,135 pairs instead of 1000 random pairs
3. Report correlation with and without filtering</p>
<p><strong>Scientific Rigor:</strong>
- Current p-values are likely too optimistic (dependency issue)
- Need bootstrap CIs or permutation tests
- Should report effect sizes, not just significance</p>
<p><strong>Data Size:</strong>
- 1000 pairs is statistically sufficient
- But ALL pairs is better (more stable, no sampling bias)
- Processing more samples (1000+ vs current 246) would strengthen conclusions</p>
<p><strong>Bottom Line:</strong> The high correlation (r=0.811) is <strong>suspicious</strong> until we verify it's not driven by duplicate/near-duplicate samples. The sensitivity analysis will reveal the truth.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>